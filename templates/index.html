{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-6">
        <!-- File Upload Section -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="upload"></i>
                    Subir Archivo Excel
                </h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                    <div class="mb-3">
                        <label for="file" class="form-label">Seleccionar archivo Excel (.xlsx, .xls)</label>
                        <input type="file" class="form-control" name="file" id="file" accept=".xlsx,.xls" required>
                        <div class="form-text">Tamaño máximo: 16MB</div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary" id="uploadBtn">
                            <i data-feather="upload"></i>
                            Procesar Archivo
                        </button>
                    </div>
                </form>
            </div>
        </div>

        {% if excel_data %}
        <!-- Excel Data Info -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="info"></i>
                    Información del Archivo
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <strong>Filas:</strong> {{ excel_data.total_rows }}
                    </div>
                    <div class="col-6">
                        <strong>Columnas:</strong> {{ excel_data.total_columns }}
                    </div>
                </div>
                <div class="mt-3">
                    <strong>Columnas disponibles:</strong>
                    <div class="mt-2">
                        {% for column in excel_data.columns %}
                            <span class="badge bg-secondary me-1">{{ column }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <div class="col-lg-6">
        {% if excel_data %}
        <!-- Auto-filled Form -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="edit"></i>
                    Formulario Auto-completado
                </h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('process_form') }}" method="post" id="dataForm">
                    {% for key, value in excel_data.form_data.items() %}
                    <div class="mb-3">
                        <label for="{{ key }}" class="form-label">{{ key }}</label>
                        <input type="text" class="form-control" name="{{ key }}" id="{{ key }}" value="{{ value }}">
                    </div>
                    {% endfor %}
                    
                    {% if excel_data.form_data %}
                    <div class="d-grid">
                        <button type="submit" class="btn btn-success">
                            <i data-feather="save"></i>
                            Procesar Formulario
                        </button>
                    </div>
                    {% endif %}
                </form>
            </div>
        </div>
        {% else %}
        <!-- Instructions -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="help-circle"></i>
                    Instrucciones
                </h5>
            </div>
            <div class="card-body">
                <ol>
                    <li>Selecciona un archivo Excel (.xlsx o .xls) usando el formulario de la izquierda.</li>
                    <li>El sistema procesará automáticamente el archivo y extraerá los datos.</li>
                    <li>Los datos de la primera fila se utilizarán para llenar automáticamente el formulario.</li>
                    <li>Puedes editar los datos en el formulario antes de procesarlos.</li>
                    <li>Haz clic en "Procesar Formulario" para completar el proceso.</li>
                </ol>
                
                <div class="alert alert-info">
                    <i data-feather="info"></i>
                    <strong>Formatos soportados:</strong> .xlsx, .xls<br>
                    <strong>Tamaño máximo:</strong> 16MB
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

{% if excel_data and excel_data.sample_data %}
<!-- Sample Data Preview -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="eye"></i>
                    Vista Previa de Datos (Primeras 5 filas)
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                {% for column in excel_data.columns %}
                                <th>{{ column }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in excel_data.sample_data %}
                            <tr>
                                {% for column in excel_data.columns %}
                                <td>{{ row.get(column, '') }}</td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if submitted_data %}
<!-- Submitted Data Display -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="check-circle"></i>
                    Datos Procesados
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Campo</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for key, value in submitted_data.items() %}
                            <tr>
                                <td><strong>{{ key }}</strong></td>
                                <td>{{ value }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
